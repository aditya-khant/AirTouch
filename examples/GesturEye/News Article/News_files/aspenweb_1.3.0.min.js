 /* aspen - v1.4.0 - 2013-12-20 
 * Copyright (c) 2013 ASPEN 
 * Licensed  
 */ 
 (function () { 
//Only load AspenWeb once 
if (window.AspenWeb) { 
 return; 
} 
var VERSION = "1.4.0"; 
var debug = [window.location.search, window.location.hash].join().search(/\bdmtdebug\b/) !== -1; 
var Class=function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/,c=function(){};return c.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.extend=arguments.callee,d},c}();!function(a,b,c){function d(){var a=m;return a.loader={load:e,i:0},a}function e(a,b,c){var d="c"==b?A:z;return s=0,b=b||"j",D(a)?f(d,a,b,this.i++,n,c):(r.splice(this.i++,0,a),1==r.length&&g()),this}function f(a,c,d,e,f,h){function i(){!n&&k(l.readyState)&&(q.r=n=1,!s&&j(),l.onload=l.onreadystatechange=null,o(function(){v.removeChild(l)},0))}var l=b.createElement(a),n=0,q={t:d,s:c,e:h};l.src=l.data=c,!u&&(l.style.display="none"),l.width=l.height="0","object"!=a&&(l.type=d),l.onload=l.onreadystatechange=i,"img"==a?l.onerror=i:"script"==a&&(l.onerror=function(){q.e=q.r=1,g()}),r.splice(e,0,q),v.insertBefore(l,u?null:p),o(function(){n||(v.removeChild(l),q.r=q.e=n=1,j())},m.errorTimeout)}function g(){var a=r.shift();s=1,a?a.t?o(function(){"c"==a.t?h(a):i(a)},0):(a(),j()):s=0}function h(a){var c,d=b.createElement("link");if(d.href=a.s,d.rel="stylesheet",d.type="text/css",a.e||!x&&!t)d.onload=function(){c||(c=1,o(function(){j()},0))},a.e&&d.onload();else{var e=function(a){o(function(){if(!c)try{a.sheet.cssRules.length?(c=1,j()):e(a)}catch(b){1e3==b.code||"security"==b.message||"denied"==b.message?(c=1,o(function(){j()},0)):e(a)}},0)};e(d)}o(function(){c||(c=1,j())},m.errorTimeout),!a.e&&p.parentNode.insertBefore(d,p)}function i(a){var c,d=b.createElement("script");d.src=a.s,d.onreadystatechange=d.onload=function(){!c&&k(d.readyState)&&(c=1,j(),d.onload=d.onreadystatechange=null)},o(function(){c||(c=1,j())},m.errorTimeout),a.e?d.onload():p.parentNode.insertBefore(d,p)}function j(){for(var a=1,b=-1;r.length-++b&&(!r[b].s||(a=r[b].r)););a&&g()}function k(a){return!a||"loaded"==a||"complete"==a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,w=a.opera&&"[object Opera]"==q.call(a.opera),x="webkitAppearance"in n.style,y=x&&"async"in b.createElement("script"),z=t?"object":w||y?"img":"script",A=x?"img":z,B=Array.isArray||function(a){return"[object Array]"==q.call(a)},C=function(a){return Object(a)===a},D=function(a){return"string"==typeof a},E=function(a){return"[object Function]"==q.call(a)},F=[],G={};m=function(a){function b(a,b){function c(a){if(D(a))e(a,i,b,0,f);else if(C(a))for(d in a)a.hasOwnProperty(d)&&e(a[d],i,b,d,f)}var d,f=!!a.test,g=f?a.yep:a.nope,h=a.load||a.both,i=a.callback;c(g),c(h),a.complete&&b.load(a.complete)}function e(a,b,e,g,h){var i=f(a),j=i.autoCallback;if(!i.bypass){if(b&&(b=E(b)?b:b[a]||b[g]||b[a.split("/").pop().split("?")[0]]),i.instead)return i.instead(a,b,e,g,h);e.load(i.url,i.forceCSS||!i.forceJS&&/css$/.test(i.url)?"c":c,i.noexec),(E(b)||E(j))&&e.load(function(){d(),b&&b(i.origUrl,h,g),j&&j(i.origUrl,h,g)})}}function f(a){var b,c,d=a.split("!"),e=F.length,f=d.pop(),g=d.length,h={url:f,origUrl:f,prefixes:d};for(c=0;g>c;c++)b=G[d[c]],b&&(h=b(h));for(c=0;e>c;c++)h=F[c](h);return h}var g,h,i=this.yepnope.loader;if(D(a))e(a,0,i,0);else if(B(a))for(g=0;g<a.length;g++)h=a[g],D(h)?e(h,0,i,0):B(h)?m(h):C(h)&&b(h,i);else C(a)&&b(a,i)},m.addPrefix=function(a,b){G[a]=b},m.addFilter=function(a){F.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=d()}(this,this.document);var Ajax={requestMap:{},jsonpRegistry:{},_counter:0,request:function(a){a=Utils.extend({timeout:5e3,maxRetries:0},a||{}),a.tries=0,this._sendRequest(a)},_sendRequest:function(a){var b=this,c=this._createCallback(a),d=this._createScript(c);return d?(d.src=a.url,a.timeout&&setTimeout(function(){b._onError(c,a)},a.timeout),void 0):(Utils.log("JSONP - unable to create script for request ",a.url),!1)},_onSuccess:function(id,obj,data){this.requestMap[id]&&(this._destroyRequest(id,obj),Utils.isString(data)&&(data=eval("("+data+")")),obj.success&&obj.success(data))},_onError:function(a,b){return this.requestMap[a]?(this._destroyRequest(a,b),b.tries++,b.maxRetries&&b.tries<b.maxRetries?(Utils.log("Request failed - resending"),this._sendRequest(b),void 0):(b.error&&b.error(b.url),void 0)):void 0},_destroyRequest:function(a,b){if(b.jsonpCallback){var c=this._removeNameFromRegistry(b.jsonpCallback);if(!c)try{delete window[b.jsonpCallback]}catch(d){window[b.jsonpCallback]=void 0}}delete this.requestMap[a];var e=document.getElementById(this._getScriptName(a));e&&(e.parentNode.removeChild(e),e=null)},_createScript:function(a){var b=document.getElementsByTagName("head")[0];if(!b)return!1;var c=document.createElement("script");return c.type="text/javascript",a&&(c.id=this._getScriptName(a)),b.appendChild(c),c},_getScriptName:function(a){return"aspen_jsonp_"+a},_createCallback:function(a){var b=this;if(Utils.empty(a.jsonpCallback))return null;this._counter++;var c="request_"+this._counter;return this.requestMap[c]=function(d){b._onSuccess(c,a,d)},this._addNameToRegistry(a.jsonpCallback),window[a.jsonpCallback]=function(a){b.requestMap[c](a)},c},_addNameToRegistry:function(a){var b=this.jsonpRegistry;return b[a]?b[a]+=1:b[a]=1,b[a]},_removeNameFromRegistry:function(a){var b=this.jsonpRegistry;return b[a]&&(b[a]-=1,0===b[a]&&delete b[a]),b[a]}},BatchService=Class.extend({init:function(a){this._enabled=!1,this._queue=[],this._config=a,this._timer,this._firstPostTimer},start:function(a){if(this._config=a,this._enabled=!0,_analyticsConfig.batchMode==BATCH_MODE_TIMER){Utils.log("[aspen]","start timer");var b=this;this._timer=setTimeout(function(){b._postTimerEvent()},1e3*Number(_analyticsConfig.batchModeAmount));var c=Math.ceil(Math.random()*Number(_analyticsConfig.batchModeAmount));c==Number(_analyticsConfig.batchModeAmount)&&(c--,0>=c&&(c=.5)),Utils.log("[aspen]","random time: "+c),this._firstPostTimer=setTimeout(function(){b._firstPostTimerEvent()},1e3*c)}},add:function(a){return this._addToQueue(a),this._enabled?(_analyticsConfig.enabled&&!this._config.batchThrottled?(_analyticsConfig.batchMode==BATCH_MODE_TOTAL?this._queue.length==_analyticsConfig.batchModeAmount&&this.post():_analyticsConfig.batchMode==BATCH_MODE_NONE?this.post():_analyticsConfig.batchMode!=BATCH_MODE_TIMER&&this.post(),this._queue.length>0&&("error"==a.eventType&&"undefined"!=typeof _analyticsConfig.highPriorityErrors?this.flushByError(a.eventData):"error"!=a.eventType&&"undefined"!=typeof _analyticsConfig.highPriorityEvents&&this.flushByEvent(a.eventType))):(_analyticsConfig.enabled&&Utils.log("[aspen]","AspenWeb is diabled via analyticsConfig. Message not added."),this._config.batchThrottled&&Utils.log("[aspen]","Batching is throttled. Message not added.")),void 0):(Utils.log("[aspen]","Batch service not enabled. Queuing message."),void 0)},_addToQueue:function(a){Utils.log("[aspen]","Adding message to batch queue."),this._queue.push(a)},post:function(){if(this._config.postThrottled)Utils.log("[aspen]","Batch posting is throttled. Batch not posted.");else{var a={sessionId:this._config.sessionId,events:this._queue};if(Utils.log("[aspen]","send batch string"),"gzip"==_analyticsConfig.batchContentEncoding){var b="?aspenJson="+JSON.stringify(a),c=encodeURIComponent(b).replace(/%20/g,"+"),d=c;a=d}TransportManager.createRequest(_analyticsConfig.batchApi,a,this._postSuccess,this._postFailure,this),this._queue=[]}},_postTimerEvent:function(){Utils.log("[aspen]","postTimer - queue.length: "+this._queue.length),this._queue.length>0?(Utils.log("[aspen]","posting "+this._queue.length+" messages"),this.post()):Utils.log("[aspen]","no messages to post");var a=this;this._timer=setTimeout(function(){a._postTimerEvent()},1e3*Number(_analyticsConfig.batchModeAmount))},_firstPostTimerEvent:function(){Utils.log("[aspen]","firstPostTimer - queue.length: "+this._queue.length),this._queue.length>0?(Utils.log("[aspen]","posting "+this._queue.length+" messages"),this.post()):Utils.log("[aspen]","no messages to post")},_postSuccess:function(a){Utils.log("[aspen]","post success: "+a)},_postFailure:function(a){Utils.log("[aspen]","post failed: "+a)},flushByError:function(a){if("undefined"!=typeof a.errorCode){var b=a.errorCode,c=b.substring(0,2),d=b.substring(2,4),e=b.substring(4,6),f=b.substring(6),g=[];g=_analyticsConfig.highPriorityErrors.split(",");for(var h="",i="",j="",k="",l=[],m=[],n=[],o=[],p=0,q=g.length;q>p;++p)switch(p){case 0:h=String(g[p]),l=h.split("+");break;case 1:i=String(g[p]),m=i.split("+");break;case 2:j=String(g[p]),n=j.split("+");break;case 3:k=String(g[p]),o=k.split("+")}for(p=0,q=l.length;q>p;++p){var r=String(l[p]);if(c==r||"*"==r)for(var s=0,t=m.length;t>s;++s){var u=String(m[s]);if(d==u||"*"==u)for(var v=0,w=n.length;w>v;++v){var x=String(n[v]);if(e==x||"*"==x)for(var y=0,z=o.length;z>y;++y){var A=String(o[y]);(f==A||"*"==A)&&(Utils.log("[aspen","[flushByError] found match, flushing batch"),this.post())}}}}}},flushByEvent:function(a){for(var b=_analyticsConfig.highPriorityEvents.split(","),c=0,d=b.length;d>c;++c){var e=String(b[c]);e==a&&(Utils.log("[aspen]","[flushBatchByEvent] found match, flushing batch"),this.post())}},setSessionId:function(a){this._config.sessionId=a},setBatchThrottled:function(a){this._config.batchThrottled=a},setPostThrottled:function(a){this._config.postThrottled=a},disableTimer:function(){_analyticsConfig.batchMode==BATCH_MODE_TIMER&&clearTimeout(this._timer)}}),LoadState={WAITING:"loadStateWaiting",LOADING:"loadStateLoading",READY:"loadStateReady",FAILED:"loadStateFailed"},AspenWeb=window.AspenWeb={init:function(a,b){var c=this;if(Utils.undef(this.initialized))if(this.initialized=!0,this.ready=!1,this.batchService,this._isThrottled=!0,this.sessionId=-1,this.timeDifference=0,this._shortId="",this._retryTimer,this._retries=0,this._retryTime=0,this._savedSession={},this._timestampStr="",this.sessionToken="",this._appName="",this._transportFormats=[],this._transportFormat="",this._transportFormatIndex=0,this._messageQueue=[],this._loadState=LoadState.WAITING,this._configUrl="",this._configLoaded=!1,this._appInitCallback=b,_params=this._options=a,this._appName=_params.appName=_params&&_params.appName,_params.appVersion=_params&&_params.appVersion,_params.site=_params&&_params.site,_params.context=_params&&_params.context,_params.configBaseUrl=_params&&_params.configBaseUrl,_params.platform=_params&&_params.platform,_params.platformVersion=_params&&_params.platformVersion,Utils.empty(_params.appName))Utils.log("[aspen]","Unable to start AspenWeb, no appName provided");else if(Utils.empty(_params.site))Utils.log("[aspen]","Unable to start AspenWeb, no site provided");else{var d={};d.batchThrottled=!0,d.postThrottled=!0,this.batchService=new BatchService(d),this._loadState=LoadState.LOADING;var e=new DependencyManager;e.add(new Dependency(Utils.bind(c._loadConfigFile,c))),e.add(new Dependency(Utils.bind(c._loadRequiredJS,c))),e.onComplete(Utils.bind(c._onDependenciesLoaded,c)),e.onFailure(Utils.bind(c._onDependenciesLoadFailure,c)),e.load()}},_loadConfigFile:function(a,b){var c=_params.configBaseUrl;Utils.isNull(c)&&(c=ANALYTICS_BASE_URL+_params.appName+"/"+_params.site+"/"),Utils.log("[aspen]","Using config base path: "+c),this._configUrl=c+ANALYTICS_FILE+"?_="+Utils.timeBucket(15),Ajax.request({jsonpCallback:"aspen_onAnalyticsConfigReceived",url:this._configUrl,success:Utils.bind(this._loadConfigSuccess,this,a),error:Utils.bind(this._loadConfigFailure,this,b)})},_loadConfigSuccess:function(a,b){Utils.log("[aspen]","Config loaded successfully"),_analyticsConfig=Utils.extend(Utils.extend({},b["default"]||{}),b[_params.context]||{}),Utils.undef(_analyticsConfig.batchMode)&&(_analyticsConfig.batchMode="total"),Utils.undef(_analyticsConfig.batchModeAmount)&&(_analyticsConfig.batchModeAmount="10"),Utils.undef(_analyticsConfig.helloRetryCount)&&(_analyticsConfig.helloRetryCount="5"),Utils.undef(_analyticsConfig.helloRetryTime)&&(_analyticsConfig.helloRetryTime="10000"),Utils.undef(_analyticsConfig.batchContentEncoding)&&(_analyticsConfig.batchContentEncoding="json"),Utils.undef(_analyticsConfig.aspenUserIdEnabled)&&(_analyticsConfig.aspenUserIdEnabled=!0),Utils.undef(_analyticsConfig.aspenUserIdHash)&&(_analyticsConfig.aspenUserIdHash="392aspenUID392"),Utils.undef(_analyticsConfig.transportFormats)?this._transportFormats.push(TransportFormat.JSONP):this._transportFormats=_analyticsConfig.transportFormats.split(","),this._transportFormat=this._transportFormats[this._transportFormatIndex];var c={};c.transportFormats=this._transportFormats,c.servicesUrl=_analyticsConfig.servicesUrl,TransportManager.init(c),Utils.log("[aspen]","batchMode: ",_analyticsConfig.batchMode),Utils.log("[aspen]","batchModeAmount: ",_analyticsConfig.batchModeAmount),Utils.log("[aspen]","helloRetryCount: ",_analyticsConfig.helloRetryCount),Utils.log("[aspen]","helloRetryTime: ",_analyticsConfig.helloRetryTime),Utils.log("[aspen]","transportFormat: ",this._transportFormat),a&&a()},_loadConfigFailure:function(a,b){Utils.log("[aspen]","Config failed to load",b),a&&a()},_loadRequiredJS:function(a,b){var c=this;null!=window.JSON?this._loadRequiredJSSuccess(a):yepnope({load:"http://z.cdn.turner.com/xslo/cvp/easyxdm/js/json2.ugly.js",complete:function(){return window.JSON?(c._loadRequiredJSSuccess(a),void 0):(c._loadRequiredJSFailure(b),void 0)}})},_loadRequiredJSSuccess:function(a){Utils.log("[aspen]","External JS dependencies loaded successfully"),a&&a()},_loadRequiredJSFailure:function(a){Utils.log("[aspen]","External JS dependencies failed to load"),a&&a()},_onDependenciesLoaded:function(){this._loadState=LoadState.READY,Utils.log("[aspen]","_onDependenciesLoaded - all required dependencies successfully loaded."),Utils.undef(_analyticsConfig.enabled)||"true"!==_analyticsConfig.enabled?(Utils.log("[aspen]","analytics disabled via config"),this._initFailure()):(Utils.log("[aspen]","analytics enabled via config"),Utils.undef(_analyticsConfig.servicesUrl)||this._hello())},_onDependenciesLoadFailure:function(){this._loadState=LoadState.FAILED,Utils.log("[aspen]","_onDependenciesLoadFailure - one or more required dependencies failed to load.")},_hello:function(){Utils.log("[aspen]","hello");var a=Utils.getQueryVar("sessionToken");Utils.log("[aspen]","check querySessionToken: ",a),Utils.empty(a)||(this.sessionToken=a,this.send("authSessionReload",{}));var b={propertyName:_params.site,applicationName:_params.appName,applicationVersion:_params.appVersion,library:"Javascript",libraryVersion:VERSION,platformName:Utils.empty(_params.platform)?"Javascript":_params.platform,platformVersion:Utils.empty(_params.platformVersion)?VERSION:_params.platformVersion,aspenConfigUrl:this._configUrl,protocol:"1.0"};_analyticsConfig.aspenUserIdEnabled&&(b.aspenUUIDToken=_analyticsConfig.aspenUserIdHash),Utils.empty(this.sessionToken)||(b.sessionToken=this.sessionToken),TransportManager.bootstrapTM(),TransportManager.createRequest(_analyticsConfig.helloApi,b,this._helloSuccess,this._helloFailure,this),this._retryTimer=setTimeout(Utils.bind(this._helloRetry,this),Number(_analyticsConfig.helloRetryTime)),this._isRetrying=!0},_helloSuccess:function(a){Utils.log("[aspen]","_helloSuccess"),clearTimeout(this._retryTimer),this._isThrottled="undefined"!=typeof a.throttled&&"no"!==a.throttled||this._isThrottled,this.sessionId="undefined"!=typeof a.sessionId?a.sessionId:this.sessionId,this._shortId="undefined"!=typeof a.shortId?a.shortId:this._shortId,this._timestampStr="undefined"!=typeof a.timestamp?a.timestamp:this.timeDifference,this.timeDifference=Number(this._timestampStr)-Utils.now(),"no"===a.throttled&&(this._isThrottled=!1),Utils.log("[aspen]","_helloSuccess"),Utils.log("[aspen]","config.throttled: "+a.throttled),Utils.log("[aspen]","throttled: "+this._isThrottled),Utils.log("[aspen]","sessionId: "+this.sessionId);var b={};b.batchThrottled=!1,b.postThrottled=!0,b.sessionId="",this.batchService.start(b),this.batchService.setSessionId(this.sessionId),this.batchService.setPostThrottled(this._isThrottled),this._initSuccess()},_helloFailure:function(a){Utils.log("[aspen]","_helloFailure url: "+a),TransportManager.fallback()&&this._hello()},_helloRetry:function(){Utils.log("[aspen]","helloRetry"),this._retries==_analyticsConfig.helloRetryCount?(Utils.log("[aspen]","retries exhasted"),clearTimeout(this._retryTimer),this._retries=0,1==TransportManager.fallback()?this._hello():(Utils.log("[aspen]","retries exhasted, fallbacks exhausted, aspen is disabled"),this._isThrottled=!0,this.batchService.setBatchThrottled(!0),this.batchService.setPostThrottled(!0),this.batchService.disableTimer())):(this._retries++,this._retryTime=this._retries*Number(_analyticsConfig.helloRetryTime),this._savedSession.retries=String(this._retries),this._savedSession.retryTime=String(this._retryTime),this._hello())},isMessageExcluded:function(a){return _analyticsConfig&&_analyticsConfig.messageExcludes&&_analyticsConfig.messageExcludes.indexOf(a)>=0?!0:!1},send:function(a,b,c){if(!this.ready)return Utils.log("[aspen]","send - AspenWeb's not ready, queuing message"),this._messageQueue.push({message:b,type:a,appName:c}),void 0;if(this._isThrottled)Utils.log("[aspen]","Add message to batch is throttled! Message not added.");else{if(this.isMessageExcluded(a))return Utils.log("[aspen]","message excluded by config, not added to batch",a),void 0;b.timestamp=Utils.now()+this.timeDifference,b.applicationName="undefined"!=typeof c?c:this._appName,Utils.log("[aspen]","appName: "+b.applicationName);var d={};d.eventType=a,d.eventData=b,Utils.log("[aspen]","add to batch json message: "+JSON.stringify(d)),this.batchService.add(d)}},setSessionToken:function(a){this.sessionToken=a},_initSuccess:function(){this.ready=!0;for(var a=0,b=this._messageQueue.length;b>a;a++)this.send(this._messageQueue[a].type,this._messageQueue[a].message);this.send("aspenConfigDetails",_analyticsConfig);var c={};c.screenWidth=screen.width,c.screenHeight=screen.height,c.browserName=navigator.appName,c.userAgent=navigator.userAgent,c.platform=navigator.platform,this.send("systemInfo",c),this._initSuccess=function(){},this._appInitCallback&&this._appInitCallback()},_initFailure:function(){},getVersion:function(){return VERSION},getSessionId:function(){return this.sessionId},getShortId:function(){return this._shortId},isThrottled:function(){return this._isThrottled},getThrottled:function(){return this._isThrottled?"yes":"no"}},DependencyManager=function(){this._dependencies=[],this._loadedCount=0,this._successHandlers=[],this._failureHandlers=[],this.add=function(a){this._dependencies.push({dependency:a,success:!1});var b=this._dependencies.length-1;a.onComplete(Utils.bind(this._onDependencyLoaded,this,b,!0)),a.onFailure(Utils.bind(this._onDependencyLoaded,this,b,!1))},this.load=function(){for(var a=0,b=this._dependencies.length;b>a;a++)this._dependencies[a].dependency.load()},this.onComplete=function(a){this._successHandlers.push(a)},this.onFailure=function(a){this._failureHandlers.push(a)},this._onDependencyLoaded=function(a,b){++this._loadedCount,this._dependencies[a].success=b,this._loadedCount===this._dependencies.length&&this._onAllDependenciesLoaded()},this._onAllDependenciesLoaded=function(){this._loadedCount=0;for(var a=!0,b=0,c=this._dependencies.length;c>b;b++)if(!this._dependencies[b].success){a=!1;break}var d=a?this._successHandlers:this._failureHandlers;for(b=0,c=d.length;c>b;b++)d[b]()}},Dependency=function(a){this._func=a,this._successHandlers=[],this._failureHandlers=[],this.load=function(){this._func(Utils.bind(this._onSuccess,this),Utils.bind(this._onFailure,this))},this.onComplete=function(a){this._successHandlers.push(a)},this.onFailure=function(a){this._failureHandlers.push(a)},this._onSuccess=function(){for(var a=0,b=this._successHandlers.length;b>a;a++)this._successHandlers[a]()},this._onFailure=function(){for(var a=0,b=this._failureHandlers.length;b>a;a++)this._failureHandlers[a]()}},AspenComm=function(){var a,b,c,d,e,f,g="http://aspen.turner.com",h=!1,i=[];return b=function(d){Utils.log("[aspen]","[easyXDM]","init",d),g=d,a=new window.CVPAux.easyXDM.Rpc({swf:"http://z.cdn.turner.com/xslo/cvp/easyxdm/swf/easyxdm.swf",remote:g+"/static/xdm_iframe.html"},{remote:{request:{}}}),Utils.log("[aspen]","[easyXDM]","init AspenComm"),h=!0,b=function(){try{throw"already init'ed - ignored"}catch(a){}},c()},d=function(a,b,c){h?f(a,b,c):e(a,b,c)},e=function(){i.push(arguments)},c=function(){for(var a=0,b=i.length;b>a;++a)f.apply(null,i[a])},f=function(b,c,d){Utils.log("[aspen]","[easyXDM]","make request",b);var e,f,g;e=Utils.extend(Utils.extend({method:"POST"},b||{})),f=function(a){var b=a.data;if("string"==typeof b&&b.charAt(0).match(/[{[]/))try{b=JSON.parse(b)}catch(d){Utils.log(d)}Utils.log("[aspen]","[easyXDM]","request success",a),c(b,a.status,a.headers)},g=function(a){var b=a.data;if("string"==typeof b&&b.charAt(0).match(/[{[]/))try{b=JSON.parse(b)}catch(c){Utils.log(c)}d(b,a.status,a.message)},a.request(e,f,g)},{init:b,request:d}}(),bootstrap=function(a){Utils.log("[aspen]","[easyXDM]","bootstrap",a),window.CVPAux=window.CVPAux||{},yepnope({test:null!=window.CVPAux.easyXDM,nope:"http://z.cdn.turner.com/xslo/cvp/easyxdm/js/easyXDM.ugly.js",complete:function(){if(window.easyXDM)window.CVPAux.easyXDM=easyXDM.noConflict("CVPAux"),yepnope({test:null!=window.JSON,nope:"http://z.cdn.turner.com/xslo/cvp/easyxdm/js/json2.ugly.js",complete:function(){if(!window.JSON)try{throw"failed to install JSON polyfill"}catch(b){}a()}});else try{throw"failed to install easyXDM"}catch(b){}}})},ANALYTICS_BASE_URL="http://z.cdn.turner.com/xslo/aspen/config/",ANALYTICS_FILE="aspenanalytics.json",BATCH_MODE_TOTAL="total",BATCH_MODE_TIMER="timer",BATCH_MODE_NONE="none",_params={},_analyticsConfig={},TransportFormat={JSON:"json",JSONP:"jsonp"},TransportManager={init:function(a){this._config=a,this._transportFormat=this._config.transportFormats[0],this._bootstrapped=!1},bootstrapTM:function(){if(Utils.log("[aspen]","TransportManager","bootstrap","_bootstrapped:",this._bootstrapped),this._transportFormat===TransportFormat.JSON&&!this._bootstrapped){var a=this._config.servicesUrl;bootstrap(function(){AspenComm.init(a)}),this._bootstrapped=!0,Utils.log("[aspen]","TransportManager","bootstrap","transportFormat",this._transportFormat)}},createRequest:function(a,b,c,d,e){if(Utils.log("[aspen]","TransportManager","createRequest"),this._transportFormat===TransportFormat.JSON)AspenComm.request({url:a+"."+this._transportFormat,data:{aspenJson:JSON.stringify(b)}},Utils.bind(c,e),Utils.bind(d,e));else if(this._transportFormat===TransportFormat.JSONP){var f=this._config.servicesUrl+a+"."+this._transportFormat;f+="?aspen_callback=parseAspenInitialization&aspenJson="+encodeURIComponent(JSON.stringify(b)).replace(/%20/g,"+"),Ajax.request({jsonpCallback:"parseAspenInitialization",url:f,error:Utils.bind(d,e),success:Utils.bind(c,e)})}},fallback:function(){return Utils.log("[aspen]","current transport format failed",this._transportFormat),this._config.transportFormats.shift(),this._config.transportFormats.length>0?(this._transportFormat=this._config.transportFormats[0],Utils.log("trying next transport format",this._transportFormat),!0):!1}},Utils={undef:function(a){return"undefined"==typeof a},isNull:function(a){return Utils.undef(a)||null===a},empty:function(a){return Utils.undef(a)||Utils.isNull(a)||""===a},isFunc:function(a){return"function"==typeof a},isObject:function(a){return"object"==typeof a},isString:function(a){return"string"==typeof a},extend:function(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a},log:function(){window.console&&window.console.log&&debug&&window.console.log(Utils.slice(arguments).join(" | ")),!Utils.undef(window.logJSAuth)&&Utils.isFunc(window.logJSAuth)&&debug&&window.logJSpAuth(Utils.slice(arguments).join(" | "))},now:"function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},slice:function(a,b){return Array.prototype.slice.call(a,b||0)},bind:function(a,b){var c=Utils.slice(arguments,2);return function(){var d=c.concat(Utils.slice(arguments));return a.apply(b,d)}},setCookie:function(a,b,c){var d=new Date;d.setDate(d.getDate()+c);var e=escape(b)+(null==c?"":"; expires="+d.toUTCString());document.cookie=a+"="+e},getCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(d)},getQueryVar:function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}},randomString:function(a){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");a||(a=Math.floor(Math.random()*b.length));for(var c="",d=0;a>d;d++)c+=b[Math.floor(Math.random()*b.length)];return c},timeBucket:function(a){var b=new Date,c=60*(24*b.getDate()+b.getHours())+b.getMinutes();return Math.round(c/a)}};
}).call(this);
