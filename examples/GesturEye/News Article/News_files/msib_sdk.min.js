(function(){window.MSIB={initialize:function(a,c){for(var b in a)a.hasOwnProperty(b)&&(MSIB.settings[b]=a[b]);"function"===typeof c&&window.setTimeout(c,10)},settings:{buildInfo:"Commit Id [sdk_build] on branch [sdk_branch]",appID:"msibsdk",baseUrlCore:"http://msib.turner.com:7080",gigyaAppID:"2_czjok49Tk5rtXeg-9mypxOEfwNqXFxZ1ei9tc_76GOasF0oJH7f7mAuGxeZJ_aya",tidCookieName:"TEGid",tidCookieDomain:"",tidCookiePath:"/",tidCookieTTL:3E5,livefyreCookieName:"Livefyre_token",livefyreCookieTTL:864E5,ajaxAlwaysCrossDomain:!1},
data:{gigyaUser:{}},msapi:{livefyre:{getToken:function(a,c){var b=MSIB.ajax({url:"/msapi/lfauthtoken",data:a});b.done(function(a,f,b){MSIB.util.isSuccessStatus(b)?MSIB.social.livefyre.storeToken(a.lfauthtoken):MSIB.social.livefyre.storeToken(null);"function"===typeof c&&c(b,f,a)});b.fail(function(a,f,b){MSIB.social.livefyre.storeToken(null);"function"===typeof c&&c(a,f,b)});return!1},topics:{get:function(a,c){var b=MSIB.ajax({url:"/msapi/lftopics.get",data:a});b.done(function(a,b,d){"function"===
typeof c&&c(d,b,a)});b.fail(function(a,b,d){console.log("failed to get topics");"function"===typeof c&&c(a,b,d)});return!1},add:function(a,c){var b=MSIB.ajax({url:"/msapi/lftopics.add",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){console.log("failed to add topics");"function"===typeof c&&c(a,b,d)});return!1},remove:function(a,c){var b=MSIB.ajax({url:"/msapi/lftopics.remove",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,
b,d){console.log("failed to remove topics");"function"===typeof c&&c(a,b,d)});return!1}}},social:{gigya:{generateSignature:function(a,c){var b=MSIB.ajax({url:MSIB.settings.baseUrlCore+"/msapi/gigya.generateSignature",data:a});b.done(function(a,b,d){"string"===typeof a&&(MSIB.util.log("NOTE: social.gigya.generateSignature response is a String: "+a),a=JSON.parse(a));"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)});return!1}}},auth:{register:function(a,c){var b=
MSIB.ajax({url:"/msapi/register",data:a});b.done(function(a,b,d){MSIB.util.isSuccessStatus(d)?(MSIB.util.user.save(a),MSIB.util.handleAuthorization(a)):MSIB.util.handleDeauthorization();"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){MSIB.util.handleDeauthorization();"function"===typeof c&&c(a,b,d)});return!1},login:function(a,c){if(!a.loginId)return MSIB.util.missingParamErr("loginId",c);if(!a.password&&!a.principalType)return MSIB.util.missingParamErr("password OR principalType",c);var b=
MSIB.ajax({url:"/msapi/login",data:a});b.done(function(b,f,d){MSIB.util.isSuccessStatus(d)?(MSIB.util.user.save(b),MSIB.util.handleAuthorization(b),"GIGYA"===a.principalType&&(a.loginId.split("|")[4]||MSIB.social.gigya.notifyRegister())):MSIB.util.handleDeauthorization();"function"===typeof c&&c(d,f,b)});b.fail(function(a,b,d){MSIB.util.handleDeauthorization();"function"===typeof c&&c(a,b,d)});return!1},logout:function(a,c){var b=MSIB.ajax({url:"/msapi/logout",data:a});b.done(function(a,b,d){MSIB.util.handleDeauthorization();
"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){MSIB.util.handleDeauthorization();"function"===typeof c&&c(a,b,d)});return!1},add:function(a,c){if(!a.tid||!a.authid||!a.authpass)return MSIB.util.missingParamErr("tid OR authid OR authpass",c);if(!a.principalType)return MSIB.util.missingParamErr("principalType",c);if(/USERNAME|EMAIL/.test(a.principalType))"function"===typeof c&&c({status:200,statusText:"OK",responseJSON:{success:!1,errors:[{error:"BAD REQUEST",message:"Invalid Principal Type"}]}},
"cached",null);else{var b=MSIB.ajax({url:"/msapi/authority.edit",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)});return!1}},remove:function(a,c){if(!a.tid||!a.authid||!a.authpass)return MSIB.util.missingParamErr("tid OR authid OR authpass",c);if(!a.type)return MSIB.util.missingParamErr("authority type",c);var b=MSIB.ajax({url:"/msapi/authority.delete",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,
b,d){"function"===typeof c&&c(a,b,d)})},saml:function(a,c){var b=MSIB.ajax({url:"/msapi/saml",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)});return!1},storeFbAccessToken:function(a,c){var b=MSIB.ajax({url:"/msapi/facebook.store.auth.token",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},validate:function(a,c){var b=MSIB.ajax({url:"/msapi/validate",
data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},csrftoken:{create:function(a,c){var b=MSIB.ajax({url:"/msapi/csrftoken.create",type:"POST",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)});return!1}}},user:{edit:function(a,c){if(!a.tid||!a.authid||!a.authpass)return MSIB.util.missingParamErr("tid OR authid OR authpass",c);var b=MSIB.ajax({url:"/msapi/user.edit",
type:"POST",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)});return!1},get:function(a,c,b){if(!a.tid||!a.authid)return MSIB.util.missingParamErr("tid OR authid",c);var e=MSIB.util.user.read();if(!b&&e&&e.attributes&&e.tid===a.tid&&e.authid===a.authid&&"function"===typeof c){if("function"===typeof c){e.success=!0;e.errors=[];var f={status:200,statusText:"OK",responseJSON:e};setTimeout(function(){c(f,"cached",e)},1)}}else return a=
MSIB.ajax({url:"/msapi/user.get",type:"POST",data:a}),a.done(function(a,b,e){MSIB.util.isSuccessStatus(e)&&MSIB.util.user.save(a);"function"===typeof c&&c(e,b,a)}),a.fail(function(a,b,e){"function"===typeof c&&c(a,b,e)}),!1},requestPasswordReset:function(a,c){var b=MSIB.ajax({url:"/msapi/password.request",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},resetPassword:function(a,c){var b=MSIB.ajax({url:"/msapi/password.reset",
data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},acceptLegalDocs:function(a,c){var b=MSIB.ajax({url:"/msapi/legal.accept",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})}},email:{add:function(a,c){var b=MSIB.ajax({url:"/msapi/email.add",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,
b,d)})},confirm:function(a,c){var b=MSIB.ajax({url:"/msapi/email.confirm",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},remove:function(a,c){var b=MSIB.ajax({url:"/msapi/email.remove",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},send:function(a,c){var b=MSIB.ajax({url:"/msapi/email.send",data:a});b.done(function(a,b,d){"function"===typeof c&&
c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},update:function(a,c){var b=MSIB.ajax({url:"/msapi/email.update",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})}},srvc:{authorize:function(a,c){var b=MSIB.ajax({url:"/msapi/service.auth",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},getServiceAuthorizations:function(a,c){var b=MSIB.ajax({url:"/msapi/service.auths",
data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},get:function(a,c){var b=MSIB.ajax({url:"/msapi/service.get",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},enrollUser:function(a,c){var b=MSIB.ajax({url:"/msapi/service.enroll",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},
edit:function(a,c){var b=MSIB.ajax({url:"/msapi/service.edit",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})}},news:{getNewsletterTypes:function(a,c){var b=MSIB.ajax({url:"/msapi/newsletter.type",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},get:function(a,c){var b=MSIB.ajax({url:"/msapi/newsletter.get",data:a});b.done(function(a,b,d){"function"===
typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},subscribe:function(a,c){var b=MSIB.ajax({url:"/msapi/newsletter.subscribe",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})},unsubscribe:function(a,c){var b=MSIB.ajax({url:"/msapi/newsletter.unsubscribe",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})}},bill:{entitlementSync:function(a,
c){var b=MSIB.ajax({url:"/msapi/billing.auth.sync",data:a});b.done(function(a,b,d){"function"===typeof c&&c(d,b,a)});b.fail(function(a,b,d){"function"===typeof c&&c(a,b,d)})}},register:function(a,c){return MSIB.msapi.auth.register(a,c)},login:function(a,c){return MSIB.msapi.auth.login(a,c)},logout:function(a,c){return MSIB.msapi.auth.logout(a,c)},getUserInfo:function(a,c){return MSIB.msapi.user.get(a,c)},editUserInfo:function(a,c){return MSIB.msapi.user.edit(a,c)},authority:{add:function(a,c){return MSIB.msapi.auth.add(a,
c)},remove:function(a,c){return MSIB.msapi.auth.remove(a,c)}}},social:{gigya:{logout:function(a){MSIB.util.test.gigya()?gigya.socialize.logout({callback:function(c){MSIB.util.saveGigyaUser(null);"function"===typeof a&&a(c)},forceProvidersLogout:!1}):"function"===typeof a&&a(null)},getUserInfo:function(a){MSIB.util.test.gigya()?gigya.socialize.getUserInfo({includeAllIdentities:!0,callback:function(c){MSIB.util.saveGigyaUser(c);"function"===typeof a&&a(c)}}):(MSIB.util.saveGigyaUser(null),"function"===
typeof a&&a(null))},notifyRegister:function(a){var c={tid:MSIB.util.getTid(),authid:MSIB.util.getAuthid()};MSIB.msapi.social.gigya.generateSignature(c,function(b,c,f){MSIB.util.isSuccessStatus(b)?(b={siteUID:MSIB.util.getTid(),UIDSig:f.signature,UIDTimestamp:f.timestamp},"function"===typeof a&&(b.callback=a),gigya.socialize.notifyRegistration(b)):console.error("Could not get Gigya signature from MSIB!")})},notifyLogin:function(a,c){var b={tid:MSIB.util.getTid(),authid:MSIB.util.getAuthid()};MSIB.msapi.social.gigya.generateSignature(b,
function(b,f,d){MSIB.util.isSuccessStatus(b)?(b={siteUID:MSIB.util.getTid(),UIDSig:d.signature,UIDTimestamp:d.timestamp,newUser:!!a,callback:function(a){MSIB.util.saveGigyaUser(a);"function"===typeof c&&c(a)}},gigya.socialize.notifyLogin(b)):console.error("Could not get Gigya signature from MSIB!")})},makeGigyaPrincipal:function(a){var c,b=[];b.push(a.signatureTimestamp);b.push(a.UID);b.push(a.UIDSignature);b.push(a.isSiteUID);for(c in a.identities)a.identities.hasOwnProperty(c)&&b.push(c+":"+a.identities[c].providerUID);
return b.join(";")}},livefyre:{login:function(a){var c=function(b){"function"===typeof a&&a(b)};if(MSIB.util.test.livefyre()){var b=function(a){MSIB.util.hasText(a)?(fyre.conv.login(a),c(!0)):c(!1)},e=MSIB.util.cookie.get(MSIB.settings.livefyreCookieName);e?b(e):MSIB.social.livefyre.getToken(b);return!1}c(!1)},logout:function(a){MSIB.social.livefyre.storeToken(null);"function"===typeof a&&a(!0)},getToken:function(a){var c=function(b){"function"===typeof a&&a(b)};if(MSIB.util.test.livefyre()){var b=
MSIB.util.user.read().displayName||null,b={tid:MSIB.util.getTid(),authid:MSIB.util.getAuthid(),displayName:b};MSIB.msapi.livefyre.getToken(b,function(a,b,d){MSIB.util.isSuccessStatus(a)?c(d):c(null)})}else c(null)},storeToken:function(a){if(MSIB.util.hasText(a)){var c=MSIB.util.cookie.getExpiryTime(MSIB.settings.livefyreCookieTTL);MSIB.util.cookie.set(MSIB.settings.livefyreCookieName,a,c,MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath)}else MSIB.util.cookie.remove(MSIB.settings.livefyreCookieName,
MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath)},isLoggedIn:function(a){var c=function(b){"function"===typeof a&&a(b)};MSIB.util.test.livefyre()?c(!0):c(!1)}}},util:{test:{livefyre:function(){return!!window.fyre&&!!window.fyre.conv&&!!window.fyre.conv.login},gigya:function(){return!!window.gigya&&!!window.gigya.socialize},jQuery:function(){return!!window.jQuery}},cookie:{getExpiryTime:function(a){return(new Date).getTime()+a},setRelative:function(a,c,b,e,f,d){b=MSIB.util.cookie.getExpiryTime(b);
MSIB.util.cookie.set(a,c,b,e,f,d)},set:function(a,c,b,e,f,d){var g=[];g.push(a+"\x3d"+encodeURIComponent(c));"number"===typeof b&&g.push("Expires\x3d"+(new Date(b)).toUTCString());MSIB.util.hasText(e)&&g.push("Domain\x3d"+e);f||(f=location.pathname.replace(/[^\/]+\.html$/,""));g.push("Path\x3d"+f);!0===d&&g.push("Secure");document.cookie=g.join("; ")},get:function(a){var c="",b,e,f;e=document.cookie.split(/ *; */);for(b=0;b<e.length;b+=1)if(f=e[b].split("\x3d"),a===f[0]){c=f[1];break}return decodeURIComponent(c)},
remove:function(a,c,b){MSIB.util.cookie.setRelative(a,null,-10,c,b)}},user:{save:function(a){if(a){var c,b=MSIB.util.user.read();for(c in a)a.hasOwnProperty(c)&&!1===/success|errors|prerequisites/i.test(c)&&(b[c]=a[c]);sessionStorage.setItem("MSIB.data.currentUser",JSON.stringify(b))}else sessionStorage.removeItem("MSIB.data.currentUser")},read:function(){var a={},c=sessionStorage.getItem("MSIB.data.currentUser");if(null!==c&&1<c.length)try{a=JSON.parse(c)}catch(b){}return a},remove:function(){MSIB.util.user.save(null)}},
missingParamErr:function(a,c){if("function"===typeof c){var b={status:200,statusText:"OK",responseJSON:{success:!1,errors:[{error:"BAD REQUEST",message:"Required parameter is missing or empty: "+a}]}};setTimeout(function(){c(b,"AJAX aborted",null)},1)}},log:function(a){console&&(console.log&&a)&&("string"!==typeof a&&(a=JSON.stringify(a)),console.log(a))},error:function(a){console&&(console.error&&a)&&("string"!==typeof a&&(a=JSON.stringify(a)),console.error(a))},normalizeLoginStatus:function(a){var c=
function(b){b||MSIB.util.fullLogout();"function"===typeof a?a(b):MSIB.util.log("Normalized login state. User is"+(b?" ":" NOT ")+"logged in.")},b=function(a){!a&&MSIB.util.test.livefyre()?c(!1):(a=MSIB.util.user.read(),a.authorities&&a.authorities.GIGYA&&MSIB.util.test.gigya()?MSIB.social.gigya.getUserInfo(function(a){!a||0!==a.errorCode||!a.user.isLoggedIn?MSIB.social.gigya.notifyLogin(!1,function(a){!a||0!==a.errorCode?c(!1):c(!0)}):c(!0)}):c(!0))},e=function(a){MSIB.util.isSuccessStatus(a)?MSIB.social.livefyre.login(b):
c(!1)},f=MSIB.util.getTid(),d=MSIB.util.getAuthid(),g=MSIB.util.getAuthpass();!f||!d||!g?c(!1):MSIB.msapi.user.get({tid:f,authid:d},e)},isSuccessStatus:function(a){return 200===a.status?a.responseJSON?a.responseJSON.success:JSON.parse(a.responseText).success:!1},hasText:function(a){return!(!a||0===a.length)},saveGigyaUser:function(a){var c=a;a&&a.user&&(c=a.user);MSIB.data.gigyaUser=c?c:{}},handleAuthorization:function(a){"string"===typeof a&&(MSIB.util.log("NOTE: login/register response is a String: "+
a),a=JSON.parse(a));var c=a.expiration;MSIB.settings.tidCookieTTL&&(c=MSIB.util.cookie.getExpiryTime(MSIB.settings.tidCookieTTL));MSIB.util.hasText(a.tid)&&MSIB.util.cookie.set(MSIB.settings.tidCookieName,a.tid,c,MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath);MSIB.util.hasText(a.authid)&&MSIB.util.cookie.set("authid",a.authid,c,MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath);MSIB.util.hasText(a.authpass)&&MSIB.util.cookie.set("authpass",a.authpass,c,MSIB.settings.tidCookieDomain,
MSIB.settings.tidCookiePath);MSIB.social.livefyre.login()},handleDeauthorization:function(){MSIB.util.user.remove();MSIB.util.cookie.remove(MSIB.settings.tidCookieName,MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath);MSIB.util.cookie.remove("authid",MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath);MSIB.util.cookie.remove("authpass",MSIB.settings.tidCookieDomain,MSIB.settings.tidCookiePath);MSIB.social.livefyre.logout()},fullLogout:function(a){MSIB.social.gigya.logout();var c=MSIB.util.getTid(),
b=MSIB.util.getAuthid();!c||!b?(MSIB.util.handleDeauthorization(),"function"===typeof a&&a(null)):MSIB.msapi.auth.logout({tid:c,authid:b},a)},getTid:function(){return MSIB.util.user.read().tid||MSIB.util.cookie.get(MSIB.settings.tidCookieName)},getAuthid:function(){return MSIB.util.user.read().authid||MSIB.util.cookie.get("authid")},getAuthpass:function(){return MSIB.util.user.read().authpass||MSIB.util.cookie.get("authpass")},getExpiryTime:function(a){return MSIB.util.cookie.getExpiryTime(a)},setRelativeCookie:function(a,
c,b,e,f,d){MSIB.util.cookie.setRelative(a,c,b,e,f,d)},setCookie:function(a,c,b,e,f,d){MSIB.util.cookie.set(a,c,b,e,f,d)},getCookie:function(a){return MSIB.util.cookie.get(a)},saveUser:function(a){MSIB.util.user.save(a)},readUser:function(){return MSIB.util.user.read()}},ajax:function(a){var c=!0;if("undefined"===typeof a.url)return!1;0!==a.url.indexOf("http")&&(a.url=MSIB.settings.baseUrlCore+a.url);/msapi\/(password\.reset|legal\.accept|email\.confirm|service\..*)/.test(a.url)&&(c=!1);"undefined"===
typeof a.data||null===a.data?a.data="":"object"===typeof a.data&&(a.data.authpass&&!a.url.match("lftopics")&&(c=!1),a.data=jQuery.param(a.data,!0));0<a.data.length&&(a.data+="\x26");a.data+="appid\x3d"+MSIB.settings.appID;a.data="garbage\x3d"+Math.random()+"\x26"+a.data;a.dataType||(a.dataType="json");a.type||(a.type="POST");a.xhrFields||(a.xhrFields={});a.xhrFields.withCredentials=!0;MSIB.settings.ajaxAlwaysCrossDomain&&(a.crossDomain=!0);a.realmEasyXDM="msib";return jQuery.ajax(a).done(function(a,
e,f){MSIB.util.isSuccessStatus(f)&&(c||MSIB.util.user.remove())})}}})();